<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML lang="ja">

<HEAD>
  <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <META http-equiv="Content-Style-Type" content="text/css">
  <META name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no">
  <TITLE> ONScripter 開発日誌 </TITLE>
  <LINK rel="stylesheet" type="text/css" href="/ogapee.css">
</HEAD>

<body>

  <div id="body">

    <div id="header">
      <h1>ONScripter 開発日誌</h1>

      Since: Feb. 6, 2002<br>
      Last updated: Aug. 24, 2023
    </div> <!-- header -->

    <div id="toc-container">

      <h3>過去の開発日誌</h3>

      <div id="toc">

        <ul>
          <li><a href="onscripter_devel.2022.html">2022年</a></li>
          <li><a href="onscripter_devel.2021.html">2021年</a></li>
          <li><a href="onscripter_devel.2020.html">2020年</a></li>
          <li><a href="onscripter_devel.2019.html">2019年</a></li>
          <li><a href="onscripter_devel.2018.html">2018年</a></li>
          <li><a href="onscripter_devel.2017.html">2017年</a></li>
          <li><a href="onscripter_devel.2016.html">2016年</a></li>
          <li><a href="onscripter_devel.2015.html">2015年</a></li>
          <li><a href="onscripter_devel.2014.html">2014年</a></li>
          <li><a href="onscripter_devel.2013.html">2013年</a></li>
          <li><a href="onscripter_devel.2012.html">2012年</a></li>
          <li><a href="onscripter_devel.2011_1.html">2011年</a></li>
          <li><a href="onscripter_devel.2010_1.html">2010年</a></li>
          <li><a href="onscripter_devel.2009_1.html">2009年</a></li>
          <li><a href="onscripter_devel.2008_1.html">2008年</a></li>
          <li><a href="onscripter_devel.2007_1.html">2007年</a></li>
          <li><a href="onscripter_devel.2006_1.html">2006年</a></li>
          <li><a href="onscripter_devel.2005_1.html">2005年</a></li>
          <li><a href="onscripter_devel.2004_1.html">2004年</a></li>
          <li>2003年
            <ul>
              <li><a href="onscripter_devel.2003_4.html">10月～12月</a></li>
              <li><a href="onscripter_devel.2003_3.html"> 7月～ 9月</a></li>
              <li><a href="onscripter_devel.2003_2.html"> 4月～ 6月</a></li>
              <li><a href="onscripter_devel.2003_1.html"> 1月～ 3月</a></li>
            </ul>
          </li>
          <li>2002年
            <ul>
              <li><a href="onscripter_devel.2002_4.html">10月～12月</a></li>
              <li><a href="onscripter_devel.2002_3.html"> 7月～ 9月</a></li>
              <li><a href="onscripter_devel.2002_2.html"> 4月～ 6月</a></li>
              <li><a href="onscripter_devel.2002_1.html"> 1月～ 3月</a></li>
            </ul>
          </li>
          <li>2001年
            <ul>
              <li><a href="onscripter_devel.2001.html">12月</a></li>
            </ul>
          </li>
        </ul>
      </div> <!-- toc -->
    </div> <!-- toc-container -->


    <div id="diary-container">
      <div id="diary">

        <h2>2023年</h2>

        <div class="diary-day">
          <h3>8月24日</h3>

          <p>みかんはっさくさんからのバグ報告に基づき、effect 命令の 15, 18 番でマスク画像を指定したときに、画像の右半分をアルファチャンネルとして読み込んでしまうバグを修正しました。</p>

          <p>ソースファイルや SDK を <a href="https://github.com/ogapee">https://github.com/ogapee</a> で公開することにしました。また、ソースファイルを .clang-format を使用して整形することにしました。</p>

        </div>

        <div class="diary-day">
          <h3>8月18日</h3>

          <p>HTMLの文字コードをEUC-JPからUTF-8に変更しました。</p>

        </div>

        <div class="diary-day">
          <h3>4月7日</h3>

          <p><a href="ios/#sdk">iOS 版 SDK</a>を更新し、Apple シリコンを搭載した Mac の Ventura v13 でビルドできるようにしました。libmad-0.15.1b 付属の config.sub と config.guess が古く Apple シリコンに対応していなかったため、最新の <a href="https://git.savannah.gnu.org/cgit/config.git/plain/config.sub">config.sub</a> と <a href="https://git.savannah.gnu.org/cgit/config.git/plain/config.guess">config.guess</a> に差し替えました。USE_SELECTOR を使用したゲームの選択は、XCode からアプリを実行してインストールした場合でないと活用できないようです。TestFlight によって内部テストでは、ゲームデータをインターネットからダウンロードすることはできました。</p>

        </div>

        <div class="diary-day">
          <h3>3月23日</h3>

          <p><a href="android/#sdk">Android 版 SDK</a> を更新し、compileSdk と targetSdk を 33 にしました。Android 13 (API 33)以降では、ActivityCompat.requestPermissions で WRITE_EXTERNAL_STORAGE を要求すると常に false を返すようになったようなので、Android 13 以降ではこの処理を飛ばすようにしました。NDK は 24.0.8215888、Android Gradle Plugin は 7.2.2、Gradle は 7.4 を使用しています。</p>

          <p>Android 版アプリで起動時にゲームを選択して実行する場合、ファイルを開くときにディレクトリの有無をキャッシュし、ディレクトリが存在しない場合には ONScripter.java の findFile 関数を呼ばないことによってファイルの読み込みを高速化しました。findFile で使用している ContentResolver.query は、ファイル名のフィルタを指定する第3,4引数が無視されるようです。そのため、これまではアーカイブ内にあるファイルを読み込む際に、アーカイブ外にはファイルが存在しないことを確認するために、ディレクトリ内の全ファイルを一つずつ照合していたため、時間がかかっていました。</p>

        </div>

        <div class="diary-day">
          <h3>1月3日</h3>

          <p>しばらく前から、Android 版アプリで一部のファイルの読み込みに失敗する問題がありましたが、ONScripter.java の findFile 関数で大文字と小文字を区別してファイル名を照合しており、スクリプト内のファイル名とファイルシステムのファイル名に大文字・小文字の違いがある場合にファイルが存在しないと判定されていたことが原因でした。<a href="android/#sdk">Android 版 SDK</a> を更新し、String.equalsIgnoreCase を使って判定するようにして解決しました。リリース前にいくつかのゲームで動作確認をするのですが、それらのゲームではこの問題が発生しなかったため気づきませんでした。</p>

        </div>

      </div> <!-- diary -->
    </div> <!-- diary-container -->


    <div id="footer">
      Copyright (c) 1998-2023 Studio O.G.A. All rights reserved.
    </div> <!-- footer -->

  </div> <!-- body -->

</body>

</html>